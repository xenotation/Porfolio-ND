{{ define "main" }}

<link rel="stylesheet" href="/css/bio-pages.css">
<link rel="stylesheet" href="/css/press.css">      {{/* press visuals: sticky h2, spacing */}}
<link rel="stylesheet" href="/css/writing.css">    {{/* one-column overrides, same as Critique */}}

{{/* language for item-level BG/EN fallbacks */}}
{{ $isBG := eq .Site.Language.Lang "bg" }}

{{/* source: data/publist.* â†’ only lectures/talks; hide noshow */}}
{{ $src := site.Data.publist | default (slice) }}
{{ $lectures := where $src "tag" "in" (slice "lecture" "talk") }}
{{ $lectures = where $lectures "noshow" "ne" true }}
{{ $lectures = where $lectures "noshow" "ne" "true" }}

{{/* split + sort for display (like Press) */}}
{{ $withYear := where $lectures "year" "!=" "" | default (slice) }}
{{ $withYear = where $withYear "year" "ne" nil }}
{{ $sorted := sort $withYear "year" "desc" }}
{{ $older  := append (where $lectures "year" "") (where $lectures "year" nil) }}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "url": "{{ .Permalink }}",
  "name": {{ printf "%q" (i18n "talks" | default "Talks & Lectures") }},
  "inLanguage": "{{ .Site.Language.Lang }}",
  "about": {
    "@type": "Person",
    "name": "{{ or .Site.Language.Params.name .Site.Params.name }}",
    {{- with (or .Site.Language.Params.profileImage .Site.Params.profileImage) -}}
    "image": "{{ . | absURL }}",
    {{- end -}}
    "url": "{{ .Site.BaseURL }}"
  },
  "mainEntity": {
    "@type": "ItemList",
    "itemListElement": [
      {{- range $i, $it := $lectures -}}
        {{- if gt $i 0 }},{{ end -}}
        {
          "@type": "ListItem",
          "position": {{ add $i 1 }},
          "item": {
            "@type": "Event",
            "name": {{ printf "%q" (cond $isBG (or $it.namebg $it.nameen) (or $it.nameen $it.namebg)) }},
            "url": {{ printf "%q" (or $it.link $it.url) }}
            {{- with (cond $isBG (or $it.descriptionbg $it.descriptionen) (or $it.descriptionen $it.descriptionbg)) -}},
            "description": {{ printf "%q" . }}{{- end -}}
            {{- with $it.date -}},
            "startDate": "{{ . }}"{{- else -}}{{ with $it.year }},
            "startDate": "{{ . }}-01-01"{{- end -}}{{- end -}},
            "performer": {
              "@type": "Person",
              "name": "{{ or $.Site.Language.Params.name $.Site.Params.name }}",
              "url": "{{ $.Site.BaseURL }}"{{ with (or $.Site.Language.Params.profileImage $.Site.Params.profileImage) }},
              "image": "{{ . | absURL }}"{{ end }}
            }{{ with (cond $isBG (or $it.inbg $it.inen) (or $it.inen $it.inbg)) }},
            "location": { "@type": "Place", "name": {{ printf "%q" . }} }{{ end }}
          }
        }
      {{- end -}}
    ]
  }
}
</script>

<div class="biolist">
  <h1 class="page-heading">{{ i18n "talks" }}</h1>

  <div class="about-wrap container--writing">
    <section class="about-body">
      <ul class="writing-list" role="list">
        {{/* Year-grouped items (single column) */}}
        {{ $current := 0 }}
        {{ range $sorted }}
          {{ if ne $current .year }}
            {{ $current = .year }}
            <li class="press-year">{{ $current }}</li>
          {{ end }}

          {{ $title := cond $isBG (or .namebg .nameen) (or .nameen .namebg) }}
          {{ $desc  := cond $isBG (or .descriptionbg .descriptionen) (or .descriptionen .descriptionbg) }}
          {{ $inTxt := cond $isBG (or .inbg .inen) (or .inen .inbg) }}

          <li class="press-item">
            <h2 class="press-titleline">
              <a class="press-link" href="{{ or .link .url }}" target="_blank" rel="noopener noreferrer">{{ $title }}</a>
            </h2>
            {{ with $desc }}<div class="press-desc">{{ . }}</div>{{ end }}
            {{ with $inTxt }}<div class="press-desc">{{ . }}</div>{{ end }}
          </li>
        {{ end }}

        {{ if gt (len $older) 0 }}
          <li class="press-year press-year-older">{{ i18n "earlier" }}</li>
          {{ range $older }}
            {{ $title := cond $isBG (or .namebg .nameen) (or .nameen .namebg) }}
            {{ $desc  := cond $isBG (or .descriptionbg .descriptionen) (or .descriptionen .descriptionbg) }}
            {{ $inTxt := cond $isBG (or .inbg .inen) (or .inen .inbg) }}

            <li class="press-item">
              <h2 class="press-titleline">
                <a class="press-link" href="{{ or .link .url }}" target="_blank" rel="noopener noreferrer">{{ $title }}</a>
              </h2>
              {{ with $desc }}<div class="press-desc">{{ . }}</div>{{ end }}
              {{ with $inTxt }}<div class="press-desc">{{ . }}</div>{{ end }}
            </li>
          {{ end }}
        {{ end }}
      </ul>
    </section>
  </div>
</div>

{{ end }}
